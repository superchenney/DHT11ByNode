var echartsDataxAxis=[],echartsDatatemp=[],echartsDatahumity=[],myChart=echarts.init(document.getElementById("tempTrendChart"));myChart.showLoading();var option={tooltip:{trigger:"axis",axisPointer:{animation:!1}},legend:{data:["温度","湿度"],textStyle:{color:"#feffff"}},xAxis:{splitLine:{show:!1},axisTick:{show:!1,lineStyle:{color:"#feffff"}},axisLabel:{textStyle:{color:"#feffff"}},axisLine:{show:!0,lineStyle:{color:"#feffff"}},data:echartsDataxAxis},yAxis:{type:"value",splitLine:{show:!1},axisTick:{show:!1,lineStyle:{color:"#feffff"}},axisLabel:{textStyle:{color:"#feffff"}},axisLine:{show:!0,lineStyle:{color:"#feffff"}}},series:[{name:"温度",type:"line",showSymbol:!1,hoverAnimation:!1,data:echartsDatatemp,markPonit:{data:[{name:"最大值",type:"max"},{name:"最小值",type:"min"}]},markLine:{data:[{name:"平均线",type:"average"}]}},{name:"湿度",type:"line",showSymbol:!1,hoverAnimation:!1,data:echartsDatahumity}],color:["#FEFFFF"]};myChart.setOption(option),$.ajax({url:"/getAllTempAndHumityInofo",type:"get",error:function(){console.log("获取历史温湿度数据出错！")},success:function(e){console.log("获取历史温湿度数据成功！");for(var t=0;t<e.length;t++)echartsDataxAxis.push(e[t].t.slice(-8)),echartsDatatemp.push(e[t].pt),echartsDatahumity.push(e[t].ph);myChart.hideLoading(),myChart.setOption({xAxis:{data:echartsDataxAxis},series:[{name:"温度",type:"line",showSymbol:!1,hoverAnimation:!1,data:echartsDatatemp},{name:"湿度",type:"line",showSymbol:!1,hoverAnimation:!1,data:echartsDatahumity}]})}}),window.addEventListener("resize",function(){myChart.resize()});var UserInfo={};$.ajax({url:"/getUserInofo",type:"get",error:function(){console.log("获取用户信息出错！")},success:function(e){"error"==e?(console.log("用户没有登录"),$("#ModelSelected").text("自动模式")):(UserInfo=e,console.log("用户信息："+UserInfo),console.log("用户"+UserInfo.PhoneNum+"已经登录"),"true"==UserInfo.WarningLock?$("#ModelSelected").text("监控模式"):$("#ModelSelected").text("自动模式"),UserInfo.WarningTemp?($("#tableWarningTempSet").text(UserInfo.WarningTemp),$("#loginPopBtn").removeClass("am-icon-user"),$("#loginPopBtn").addClass("am-icon-get-pocket"),$("#warningHistory").css("display","block")):($("#loginPopBtn").removeClass("am-icon-get-pocket"),$("#loginPopBtn").addClass("am-icon-user"),$("#warningHistory").css("display","none")))}});var socket=io.connect("http://chenchao.ngrok.natapp.cn");socket.on("realTimeTAndH",function(e){console.log(e),echartsDataxAxis.shift(),echartsDatatemp.shift(),echartsDatahumity.shift(),echartsDataxAxis.push(e.date.slice(-8)),echartsDatatemp.push(e.temperature),echartsDatahumity.push(e.humidity),myChart.hideLoading(),myChart.setOption({xAxis:{data:echartsDataxAxis},series:[{name:"温度",type:"line",showSymbol:!1,hoverAnimation:!1,data:echartsDatatemp},{name:"湿度",type:"line",showSymbol:!1,hoverAnimation:!1,data:echartsDatahumity}]}),document.getElementById("realTimeCirleTemp").innerHTML=e.temperature,document.getElementById("tableRtTemp").innerHTML=e.temperature,document.getElementById("tableRtHumd").innerHTML=e.humidity,UserInfo.WarningTemp&&e.temperature>=UserInfo.WarningTemp?($("body").removeClass("bkg-norm"),$("body").addClass("bkg-warning")):($("body").removeClass("bkg-warning"),$("body").addClass("bkg-norm"))}),$(".phone-login").show(),$(".phone-signup").hide(),$("#getRegistCode").click(function(){function e(e){var t=/^1((3|5|8){1}\d{1}|70)\d{8}$/;return!!t.test(e)}var t=$("#registPhoneNum").val();e(t)&&$.ajax({url:"/getRegistCode",type:"post",data:{phoneNum:t},error:function(){alert("error")},success:function(e){$("#getRegistCode").text("已发送！"),$("#getRegistCode").addClass("am-disabled")}})}),$("#signup-box-link").click(function(){$(".phone-login").fadeOut(100),$(".phone-signup").delay(100).fadeIn(100),$("#login-box-link").removeClass("active"),$("#signup-box-link").addClass("active")}),$("#login-box-link").click(function(){$(".phone-login").delay(100).fadeIn(100),$(".phone-signup").fadeOut(100),$("#login-box-link").addClass("active"),$("#signup-box-link").removeClass("active")}),$("#loginPannel").validator({onValid:function(e){$(e.field).closest(".u-form-group").find(".am-alert").hide()},onInValid:function(e){var t=$(e.field),a=t.closest(".u-form-group"),o=a.find(".am-alert"),n=t.data("validationMessage")||this.getValidationMessage(e);o.length||(o=$('<div class="am-alert am-alert-danger" style="width: 90%;max-width: 300px;margin:5px auto;font-size:12px;line-height:12px;padding:7px;"></div>').hide().appendTo(a)),o.html(n).show()}}),$("#registPannel").validator({onValid:function(e){$(e.field).closest(".u-form-group").find(".am-alert").hide()},onInValid:function(e){var t=$(e.field),a=t.closest(".u-form-group"),o=a.find(".am-alert"),n=t.data("validationMessage")||this.getValidationMessage(e);o.length||(o=$('<div class="am-alert am-alert-danger" style="width: 90%;max-width: 300px;margin:5px auto;font-size:12px;line-height:12px;padding:7px;"></div>').hide().appendTo(a)),o.html(n).show()}});var $modal=$("#loginModel");$("#loginModel").on("open.modal.amui",function(){console.log("弹窗打开"),$("#tempBackPannel").css("visibility","hidden")}),$("#loginModel").on("close.modal.amui",function(){console.log("弹窗关闭"),$("#tempBackPannel").css("visibility","visible")}),$("#loginPopBtn").on("click",function(e){var t=$(e.target);UserInfo.PhoneNum?location.href="/setting":t.hasClass("js-modal-open")&&($modal.modal(),$("#getRegistCode").removeClass("am-disabled"),$("#getRegistCode").text("获取验证码"))});